;  POSCHD / POR - D11
;
;:
;
;		IN PREPARATION FOR PRINTING SCHEDULED RECEIPTS REPORTS,
;			CHECK TO SEE IF PO FILES NEED SORTING.  IF SO, SORT
;			AND/OR RE-ORG THE FILES.
;
;

RECORD DUMHDR	
	.INCLUDE 'DEF:RD151B.DEF'

RECORD DUMLIN	
	.INCLUDE 'DEF:RD152B.DEF'

RECORD CTL
	ROW	,D2
		,A1
	COL	,D2
		,A1
	MAX	,D2
		,A1
	MIN	,D2
		,A1
	TYPE	,A2

RECORD SNDMSG
	PRGNAM	,A9
	RCNT	,D5
	OCNT	,D5

RECORD
	BLANKS	,A10
	ENTRY	,A30
	INXCTL	,D1
	LOKCTL	,D1
	MSGCTL	,D1
	NOABRT	,D1,	1
	NXTPGM	,A9,	'PO:POSCRG'
	READ	,D1,	0
	SEL	,D1
	SWITCH	,D1
	V	,D1

PROC
	XCALL TERID (V)
	XCALL OUTPT (1,1,2,'SCHEDULED RECEIPTS REPORTS',1)
	XCALL WATE (4,V)
OPENUP,
	SWITCH = 1
	XCALL FILES (1,'I',151,SWITCH)		;OPEN FOR INPUT
	IF (SWITCH.EQ.9) GO TO INUSE1

	SWITCH = 1
	XCALL FILES (2,'I',152,SWITCH)		;OPEN FOR INPUT
	IF (SWITCH.EQ.9) GO TO INUSE2

	LOKCTL = NOABRT
	XCALL IO (1,DUMHDR,1,READ,LOKCTL)
	LOKCTL = NOABRT
	XCALL IO (2,DUMLIN,1,READ,LOKCTL)
	XCALL FILES (1,'I',151,4)
	XCALL FILES (2,'I',152,4)

	IF (ORG151.NE.REC151) GO TO SORT1
	IF (DEL151.GT.10) GO TO RORG1
	IF (ORG152.NE.REC152) GO TO SORT2
	IF (DEL152.GT.50) GO TO RORG2
	XCALL PGCHN ('PO:POSCRG',1)

SORT1,
	CALL PROTCT
	PRGNAM = 'PO:POHCNT'
	RCNT = REC151
	OCNT = ORG151

	MSGCTL = 5
;**	XCALL SNMSG (SNDMSG,MSGCTL)
;**	MSGCTL = 2
	XCALL SNMSG (NXTPGM,MSGCTL)
	XCALL PGCHN ('PO:SRTPOH',1)
RORG1,
	CALL PROTCT
	MSGCTL = 5
	XCALL SNMSG (NXTPGM,MSGCTL)
	XCALL PGCHN ('PO:ORGPOH',1)
SORT2,
	CALL PROTCT
	PRGNAM = 'PO:POLCNT'
	RCNT = REC152
	OCNT = ORG152

	MSGCTL = 5
;**	XCALL SNMSG (SNDMSG,MSGCTL)
;**	MSGCTL = 2
	XCALL SNMSG (NXTPGM,MSGCTL)
	XCALL PGCHN ('PO:SRTPOL',1)
RORG2,
	CALL PROTCT
	MSGCTL = 5
	XCALL SNMSG (NXTPGM,MSGCTL)
	XCALL PGCHN ('PO:ORGPOL',1)
;**********************************************************************
INPUT,
	XCALL INPUT (ROW,COL,MAX,MIN,TYPE,ENTRY,INXCTL,V)
	RETURN
;**********************************************************************
PROTCT,
	SWITCH = 3
	XCALL FILES (1,'U',151,SWITCH)		;FILE 151, PROTECT PORHDR FILE.
	IF (SWITCH.EQ.9) GO TO INUSE1

	SWITCH = 3
	XCALL FILES (2,'U',152,SWITCH)		;FILE 152, PROTECT PORLIN FILE.
	IF (SWITCH.EQ.9) GO TO INUSE2
	RETURN
;**********************************************************************
EXIT,
	XCALL FILES (2,'U',152,4)
INUSE2,
	XCALL FILES (1,'U',151,4)
INUSE1,
	XCALL PGCHN ('PO:POMENU',1)
;**********************************************************************

END

