;  PORITM / POR - D11
;
;
;
;
RECORD RCVHST
	.INCLUDE 'DEF:RD154A.DEF'

RECORD PLINE
 		,A132

RECORD LINE1,X
	KVEND	,A4
		,A1
	KIMNUM	,A12
		,A1
	KIMDES	,A30
		,A1
	KMTH1	,A6
		,A1
	KMTH2	,A6
		,A1
	KMTH3	,A6
		,A1
	KMTH4	,A6
		,A1
	KMTH5	,A6
		,A1
	KMTH6	,A6
		,A1
	KMTH7	,A6
		,A1
	KMTH8	,A6
		,A1
	KMTH9	,A6
		,A1
	KMTH10	,A6
		,A1
	KMTH11	,A6
		,A1
	KMTH12	,A6

RECORD,X
		,A48
	MONTHS	,12A7

RECORD HDR1
		,A4,	'VEND'
		,A1
		,A11,	'PART-NUMBER'
		,A2
		,A11,	'DESCRIPTION'
		,A23
		,A3,	'JAN'
		,A4
		,A3,	'FEB'
		,A4
		,A3,	'MAR'
		,A4
		,A3,	'APR'
		,A4
		,A3,	'MAY'
		,A4
		,A3,	'JUN'
		,A4
		,A3,	'JUL'
		,A4
		,A3,	'AUG'
		,A4
		,A3,	'SEP'
		,A4
		,A3,	'OCT'
		,A4
		,A3,	'NOV'
		,A4
		,A3,	'DEC'

RECORD LEGEND
		,A1
		,A18,'DATE RECEIVED FROM'
		,A3
	DTE1	,A8
		,A3
		,A2,'TO'
		,A3
	DTE2	,A8
		,A7
		,A15,'COMMODITY CODE:'
		,A2
	CODE	,A4
		,A58

RECORD DASHES
		,A50,	'--------------------------------------------------'
		,A50,	'--------------------------------------------------'
		,A32,	'--------------------------------'

RECORD RKEY
	RITEM	,A15

RECORD
	CNGCTL	,D1
	WHATNO	,D1
	TNUM	,D3
	BLANKS	,A15
	BRACKS	,A30,	']]]]]]]]]]]]]]]]]]]]]]]]]]]]]]'
	BSMID	,D5
	CNTR	,D3
	DSPSW	,D1
	EOF	,D1
	IDFLAG	,D1
	LINCNT	,D2,	60
	LINCTL	,D1
	LOKCTL	,D1
	LPSW	,D1
	NOABRT	,D1,	1
	PGCNT	,D3,	000
	PRTCTL	,D3
	PRTTYP	,A1
	READ	,D1,	0
	RPTNUM	,D3
	SPLFIL	,A14
	SRCOPT	,D1
	SRCCTL	,D1
	KEY	,A15
	BSEND	,D5
	SWITCH	,D1
	TITLE	,A*,	'RECEIVING MONTHLY REPORT BY ITEM/VENDOR'
	TODAY	,D6
	V	,D1
	WTARG	,D1,	2
	STRTLO	,A4
	XRECNO	,D5
	INXCTL	,D1
	ENTRY	,A15
	ALL	,A10
	ASOFDT	,A8
	STDATE	,D6
	ENDATE	,D6
	HLDATE	,D6
	SVEND	,A4
	EVEND	,A4
	COMOPT	,A4
	LSTITM	,A15
	LSTVND	,A4
	LSTDSC	,A30
	ALPHA	,A4
	TOTMTH	,12D6
	MTH	,D2
	TT	,D2
	MASK	,A6,'ZZ,ZZX'


PROC
	XCALL TERID (V)
	XCALL OUTPT (2,1,2,'MONTHLY RECEIVING REPORT BY VENDOR/ITEM',1)
GETDAT,
 	XCALL OUTPT (4,20,2,'PLEASE ENTER STARTING RECEIVE DATE',V)
	XCALL INPUT (4,56,6,0,'DE',ENTRY,INXCTL,V)
	GO TO (GETDAT,ENDOFF), INXCTL
	HLDATE = ENTRY (1,6)
	IF (HLDATE.EQ.0) XCALL RDATE (HLDATE)
	IF (HLDATE.EQ.0) GO TO GETDAT
	STDATE(1,2) = HLDATE(5,6)
	STDATE(3,6) = HLDATE(1,4)
	DTE1 = HLDATE, 'XX/XX/XX'
	ASOFDT = HLDATE, 'XX/XX/XX'
	XCALL OUTPT (4,56,0,ASOFDT,V)
GETDT2,
	XCALL OUTPT (5,20,2,'PLEASE ENTER ENDING RECEIVE DATE',V)
	XCALL INPUT (5,56,6,0,'D ',ENTRY,INXCTL,V)
	GO TO (GETDAT), INXCTL
	HLDATE = ENTRY (1,6)
	IF (HLDATE.EQ.0) XCALL RDATE (HLDATE)
	IF (HLDATE.EQ.0) GO TO GETDT2
	ENDATE(1,2) = HLDATE(5,6)
	ENDATE(3,6) = HLDATE(1,4)
	DTE2 = HLDATE, 'XX/XX/XX'
	ASOFDT = HLDATE, 'XX/XX/XX'
	XCALL OUTPT (5,56,0,ASOFDT,V)
STVND,
	XCALL OUTPT (7,20,2,'PLEASE ENTER STARTING VENDOR',V)
	XCALL INPUT (7,50,04,0,'A ',ENTRY,INXCTL,V)
	GO TO (GETDT2), INXCTL
	IF (ENTRY(1,4).EQ.BLANKS) GOTO ALLVND
	XCALL FRMAT (ENTRY(1,4),4)
	SVEND = ENTRY (1,4)
ENVND,
	XCALL OUTPT (8,20,2,'PLEASE ENTER ENDING VENDOR',V)
	XCALL INPUT (8,50,04,0,'A ',ENTRY,INXCTL,V)
	GO TO (STVND), INXCTL
	IF (ENTRY(1,4).NE.BLANKS)
	THEN	BEGIN
		XCALL FRMAT (ENTRY(1,4),4)
		EVEND = ENTRY (1,4)
		END
	ELSE
		BEGIN
		EVEND = SVEND
		END
	XCALL OUTPT (8,50,0,EVEND,V)
COM,
	XCALL OUTPT (10,20,2,'COMMODITY CODE:',V)
	XCALL INPUT (10,39,04,0,'A ',ENTRY,INXCTL,V)
	GOTO (ENVND), INXCTL
	IF (ENTRY.EQ.'    ') ENTRY = ']]]]'
	COMOPT = ENTRY(1,4)
	STRTLO = COMOPT
	ALPHA = COMOPT
	IF (COMOPT.EQ.']]]]') ALPHA = 'ALL'
	XCALL OUTPT (10,39,0,ALPHA,V)
	CODE = ALPHA
	GOTO START
ALLVND,
	ALL = 'ALL VENDS'
	SVEND=
	EVEND='[[[['
	XCALL OUTPT(7,50,0,ALL,V)
	GOTO COM
START,
	CNGCTL=2
	XCALL ANYCN(CNGCTL,WHATNO)
	GOTO (GETDAT),CNGCTL
	XCALL WATE (4,V)
	XCALL RDATE (TODAY)
	SPLFIL(5,6) = 'NA'

	LPSW = 1
	XCALL LPON (LPSW,SPLFIL)
	IF (LPSW.EQ.0) GO TO EXIT

	IF (LPSW.EQ.2) WTARG = 4
	XCALL WATE (WTARG,V)
	
	SWITCH = 5		
	XCALL FILES (2,'SI',154,SWITCH)		;RCVHST FILE

PROCES,
	RITEM = 
	FIND (2,RCVHST,RKEY,KRF="ITEMDATE")[ERR=OPNLOOP]

OPNLOOP,
	CALL READIX
	IF (EOF.EQ.1) GOTO DONE
	IF (RCVINO.NE.LSTITM) CALL PRTIT
CALMTH,
	MTH = RDTERC(3,4)
	TOTMTH(MTH) = TOTMTH(MTH) + RCVNOW
	GOTO OPNLOOP
PRTIT,
	IF (LSTITM.EQ.BLANKS) GOTO CLRIT
	KVEND = LSTVND
	KIMNUM = LSTITM
	KIMDES = LSTDSC
	KMTH1 = TOTMTH(1),MASK
	KMTH2 = TOTMTH(2),MASK
	KMTH3 = TOTMTH(3),MASK
	KMTH4 = TOTMTH(4),MASK
	KMTH5 = TOTMTH(5),MASK
	KMTH6 = TOTMTH(6),MASK
	KMTH7 = TOTMTH(7),MASK
	KMTH8 = TOTMTH(8),MASK
	KMTH9 = TOTMTH(9),MASK
	KMTH10 = TOTMTH(10),MASK
	KMTH11 = TOTMTH(11),MASK
	KMTH12 = TOTMTH(12),MASK
	CALL PRINT
	INCR CNTR
CLRIT,
	LSTITM = RCVINO
	LSTVND = RVENDR
	LSTDSC = RCVDSC
	FOR TT FROM 1 THRU 12
		BEGIN
		TOTMTH(TT) = 0
		END
	RETURN

DONE,
	XCALL LINFD(1)
	LINCNT = LINCNT+1
;;	PLINE = DASHES
;;	CALL PRINT
;;	PLINE(1,12) = 'GRAND TOTAL:'
;;	KEXT = ACCEXT,'ZZ,ZZZ,ZZX.XX'
;;	KUNIT = ACCSTD,'ZZ,ZZZ,ZZX.XX'
;;	CALL PRINT
	XCALL LPOFF (LPSW,SPLFIL,PGCNT)
	XCALL WATE (3,V)
	GO TO EXIT

;**********************************************************************
;	READ ONE RCVHST RECORD AND RETURN
;**********************************************************************
READIX,
	EOF =
REREAD,
	LOKCTL = NOABRT
	XCALL IOS (2,RCVHST,READ,LOKCTL)
	IF (LOKCTL.EQ.2) GOTO ENDFIL
	IF (RDTERC.LT.STDATE.OR.RDTERC.GT.ENDATE) GOTO REREAD
;;	IF (RNOSTD.EQ.1) GOTO REREAD
	IF (EVEND.EQ.'[[[[') GOTO CHKCOM
	IF (RVENDR.LT.SVEND) GOTO REREAD
	IF (RVENDR.GT.EVEND) GOTO REREAD
CHKCOM,
	IF (STRTLO.EQ.']]]]') RETURN
	IF (RITMCC.NE.STRTLO) GOTO REREAD
	RETURN
ENDFIL,
	EOF = 1
	RETURN
;**********************************************************************
PRINT,
	PRTCTL = 132
	XCALL LPOUT (LINCNT,PGCNT,PLINE,TITLE,HDR1,'NO HDR','NO HDR',
&		LEGEND,'NO LEGEND',' ',LINCTL,132,PRTCTL,0,LPSW,RPTNUM,PRTTYP)
	RETURN
;**********************************************************************
CLOSES,
	XCALL FILES (2,'SI',154,4)
	RETURN
;**********************************************************************
EXIT,
	CALL CLOSES
ENDOFF,
	XCALL PGCHN ('PO:VAMENU',1)
;**********************************************************************

END

