;  PVNMNT  /  POR - D11
;
;
;		VENDOR MAINTENANCE
;
RECORD	COPTBL
	.INCLUDE 'DEF:RD182A.DEF'

RECORD RD011A	
	.INCLUDE 'DEF:RD011A.DEF'

RECORD RD011B	
	.INCLUDE 'DEF:RD011B.DEF'

RECORD	VENBUF			;SSQ 1-9-02
	.INCLUDE 'DEF:RD011X.DEF'

RECORD	VENBF2			;SSQ 1-9-02
	.INCLUDE 'DEF:RD011X.DEF'

RECORD RD012A	
	.INCLUDE 'DEF:RD012A.DEF'

RECORD RD153B	
	.INCLUDE 'DEF:RD153B.DEF'

RECORD RD153A
	.INCLUDE 'DEF:RD153A.DEF'

RECORD CONTRL
	ROW	,D2
		,A1
	COL	,D2
		,A1
	MAX	,D2
		,A1
	MIN	,D2
		,A1
	TYPE	,A2

RECORD CLEAR
	KVENNO	,A4
	KNAME	,A15
	KACTIV	,A1
	KCONTC	,A20
	KFOB	,A1
	KSPVIA	,A1
	KTERMS	,A1
	KUSRCD	,A2
	KPRTPC	,A1
	KACK	,A1
	KCNFRM	,A1
	KCTIVE	,A1
	KPOS	,D3
	KLINES	,D4
	KLSLAT	,D4
	KPRIOR	,D3
	KVARNC	,D3
	KPREJ	,D3
	KLDTM	,D3
	KDYSLA	,D3
	KCOMCD	,5A4

RECORD	ARRAYS
	SVCODE	,10A1
	SVSCAC	,10A4
	SVRFA	,10A6
	NUMSV	,D3

RECORD	SVLINE
	SVL_CODE	,A1
		,A3,	' = '
	SVL_SCAC	,A4
		,A1
	SVL_NAME	,A15

RECORD	CHANNEL
	CHN011	,D2
	CHN012	,D2
	CHN153	,D2
	CHN182	,D2

RECORD 	VARS
	KL	,D6
	OPNOK	,D1
	SUB	,D3
	ACTFMT	,A1
	BRAKTS	,A20,	']]]]]]]]]]]]]]]]]]]]'
	BSEND	,D5
	BLANKS	,A10
	BSMID	,D5
	CNGCTL	,D1
	DECMAL	,D4
	DLAFMT	,A3
	DUMMY	,A2
	ENTRY	,A20
	TBLFND	,A3
	FIRST	,D1
	INXCTL	,D1
	KDESC	,A15
	LDTFMT	,A3
	LSLFMT	,A4
	LNSFMT	,A4
	LOKCTL	,D1
	NOABRT	,D1,	1
	NUM	,D1
	POSFMT	,A3
	PYRFMT	,A3
	READ	,D1,	0
	READS	,D1,	0
	RECNO	,D5
	REJFMT	,A3
	SAVTNO	,D2
	SELECT	,D1
	SRCCTL	,D1
	SWITCH	,D1
	TAB	,D1
	PBLKEY	,D2
	VARFMT	,A3
	WRITE	,D1,	1
	WHATNO	,D2
	V	,D1
	XRECNO	,D5


PROC
	XCALL TERID (V)
RCVMNU,
	XRECNO = 1
	TAB =
	XCALL OUTPT (1,1,2,'VENDOR MAINTENANCE',1)
	XCALL OUTPT (5,20,0,'PLEASE SELECT APPLICATION',V)
	XCALL OUTPT (6,25,0,'1. ADD VENDOR DATA',V)
	XCALL OUTPT (7,25,0,'2. CHANGE/INQUIRE VENDOR DATA',V)
	XCALL OUTPT (8,25,0,'3. PRINT VENDOR LISTING',V)
	XCALL OUTPT (9,25,0,'4. DEFAULT ENTRY',V)
;;;	XCALL OUTPT (10,25,0,'5. CONTACTS',V)
MNUSEL,
	CONTRL = '05,47,01,00,#E'
	CALL INPUT
	GO TO (MNUSEL,ENDOFF), INXCTL
	SELECT = ENTRY
	IF (SELECT.EQ.0.OR.SELECT.GT.4) GO TO MNUSEL
	GO TO (DISPLA,DISPLA,PRINT,DEFOLT,CONTACT), SELECT
CONTACT,
;;;	XCALL PGCHN ('PO:VCNMNT',1)
;**********************************************************************
PRINT,
	XCALL PGCHN ('PO:PVNLST',1)

DEFOLT,
	XCALL PGCHN ('PO:PVNDFT',1)

ENDOFF,
	CALL CLOSE
	XCALL PGCHN ('PO:POSFMN',1)

;**********************************************************************
DISPLA,
	CALL OPENS
	IF (.NOT. OPNOK) GOTO ENDOFF

SCREEN,
	CNGCTL =
	UNLOCK 2
	RD011A =
	IF (SELECT) XCALL OUTPT (2,1,2,'ADD',1)
	IF (SELECT.EQ.2) XCALL OUTPT (2,1,0,'CHANGE/INQUIRE',1)
	XCALL OUTPT (2,28,0,'1. VENDOR NUMBER',1)
	XCALL OUTPT (2,28,0,'2. VENDOR NAME',V)
	XCALL OUTPT (3,2,0,'3. CONTACT',V)
	XCALL OUTPT (4,2,0,'4. FOB CODE',V)
	XCALL OUTPT (5,2,0,'5. SHIP-VIA',V)
	XCALL OUTPT (6,2,0,'6. TERMS CODE',V)
	XCALL OUTPT (7,2,0,'7. USER CODE',V)
	XCALL OUTPT (8,2,0,'8. PRT PRICE ?',V)
	XCALL OUTPT (9,2,0,'9. ACKNOWLEDGE ?',V)
	XCALL OUTPT (10,1,0,'10. CONFIRM ?',V)
	XCALL OUTPT (11,1,0,'11. FAX #',V)
;;;	XCALL OUTPT (11,1,0,'11. ACTIVE ?',V)
	XCALL OUTPT (3,47,0,'12. COLLECT/PRE-PAID',V)

;**********************************************************************
VENNUM,
	XCALL INPUT (02,46,04,00,'AX',ENTRY,INXCTL,1)
	GO TO (SCREEN,ENDOFF,TABONE), INXCTL
	IF (ENTRY.EQ.BLANKS) GO TO SKIP
	XCALL FRMAT (ENTRY(1,4),4)
	KVENNO = ENTRY

	LOKCTL = NOABRT
	XCALL ISIO (2, RD011A, KVENNO, READ, LOKCTL)
	IF (LOKCTL) GOTO MSG1

;;;	XCALL SERCH (1,RD012A,KVENNO,1,4,ORG011,BSMID,SRCCTL,1,6,10,0,0,0,0)
;;;	IF (SRCCTL) GO TO MSG1
;;;	XRECNO = BSMID
;;;	LOKCTL = NOABRT
;;;	XCALL IO (2,RD011A,IRC011,READ,LOKCTL)

	UNLOCK 2		;SSQ 01-09-02
	VENBUF = RD011A		;SSQ 01-09-02

	IF (ACTIVE.NE.BLANKS.AND.SELECT.EQ.1) GO TO MSG4
	GO TO VALUES
SKIP,
	CONTRL = '02,46,15,01,A '
	CALL INPUT
	GO TO (SCREEN),INXCTL
	KNAME = ENTRY
	KL = %TRIM(KNAME)

	FIND (2, RD011A, KNAME, KRF:1) [ERR=NO_ALPHA]
NO_ALPHA,
	LOKCTL = 1
	XCALL IOS (2, RD011A, READ, LOKCTL)
	IF (NAME .NE. KNAME(1,KL) ) GOTO NAMNTF

;;;	SRCCTL = 2
;;;	BSMID = 1
;;;	XCALL SERCH (2,RD011A,KNAME,6,35,ORG011,BSMID,SRCCTL,5,6,11,0,0,0,0)
;;;	IF (SRCCTL) GO TO NAMNTF
;;;	IRC011 = BSMID
;;;	LOKCTL = 1
;;;	XCALL IO (2,RD011A,IRC011,READ,LOKCTL)

	UNLOCK 2		;SSQ 01-09-02
	VENBUF = RD011A		;SSQ 01-09-02

	IF (ACTIVE.NE.BLANKS .AND. SELECT.EQ.1) GO TO MSG4
	GO TO VALUES
NAMNTF,
	XCALL MESAG ('RECORD NOT ON FILE',1)
	XCALL OUTPT (2,46,1,'\',V)
	GO TO VENNUM

TABONE,
	IF (TAB) GO TO TABLOP
	TAB = 1

TABLOP,
;;;	INCR XRECNO
;;;	LOKCTL = NOABRT
;;;	XCALL IO (1,RD012A,XRECNO,READ,LOKCTL)
;;;	UNLOCK 1
;;;	IF (RD012A(1,10).EQ.BRAKTS) GO TO MSG3
;;;	IF (RD012A(6,10).EQ.'00000') GO TO TABLOP

	LOKCTL = NOABRT
	XCALL IOS (2,RD011A,READ,LOKCTL)
	UNLOCK 2		;SSQ 01-09-02
	VENBUF = RD011A		;SSQ 01-09-02

	IF (SELECT.EQ.1.AND.ACTIVE.NE.BLANKS) GO TO TABLOP

;**********************************************************************
VALUES,
	XCALL OUTPT (2,46,0,VENNO,1)
	XCALL OUTPT (2,46,0,NAME,V)
	IF (SELECT.EQ.1) GO TO THREE
	XCALL OUTPT (3,20,0,CONTCT,V)
	XCALL OUTPT (4,20,0,FOB,V)
	XCALL OUTPT (5,20,0,SHPVIA,V)
	XCALL OUTPT (6,20,0,TERMS,V)
	XCALL OUTPT (7,20,0,USERCD,V)
	XCALL OUTPT (8,20,0,PRTPRC,V)
	XCALL OUTPT (9,20,0,ACKNWL,V)
	XCALL OUTPT (10,20,0,CONFRM,V)

	ENTRY(1,12) = VFAX,	'XXX-XXX-XXXX'
	XCALL OUTPT (11,20,0,ENTRY(1,12),V)

	XCALL OUTPT (3,76,0,COLPPD,V)

	IF (SELECT.EQ.2) GO TO ANYCN

;**********************************************************************
THREE,
	CONTRL = '03,20,20,00,A '
	CALL INPUT
	IF (INXCTL) GO TO SCREEN
	CONTCT = ENTRY
	IF (CNGCTL) GO TO ANYCN

FOUR,
	PBLKEY = 05
	CALL FNDTBL
	CONTRL = '04,20,01,00,A '
	CALL INPUT
	IF (INXCTL) GO TO SCREEN
	IF (ENTRY.EQ.BLANKS) ENTRY = DFTFOB
	FOB = ENTRY
	XCALL OUTPT (ROW,COL,0,FOB,V)
	TBLFND(1,2) = '05'
	TBLFND(3,3) = ENTRY
	CALL CLRTBL
	SRCCTL = 2
	XCALL SERCH (3,RD153A,TBLFND,1,3,ORG153,BSMID,SRCCTL,1,6,11,0,0,0,0)
	IF (SRCCTL.EQ.0.AND.CNGCTL) GO TO ANYCN
	IF (SRCCTL.EQ.0) GO TO FIVE
	XCALL MESAG ('CODE IS NOT ON FILE',1)
	GO TO FOUR

FIVE,
	CALL S_VIA
	CONTRL = '05,20,01,00,A '
	CALL INPUT
	IF (INXCTL) GO TO SCREEN
	IF (ENTRY.EQ.BLANKS) ENTRY = SVCODE(1)

	SHPVIA = ENTRY
	XCALL OUTPT (ROW,COL,0,SHPVIA,V)
	CALL CLRTBL


	FOR SUB FROM 1 THRU NUMSV
		BEGIN
		IF (SHPVIA .EQ. SVCODE(SUB)) GOTO SV_OK
		END

	XCALL MESAG ('CODE IS NOT ON FILE',1)
	GO TO FIVE
SV_OK,

SIX,
	PBLKEY = 04
	CALL FNDTBL
	CONTRL = '06,20,01,00,A '
	CALL INPUT
	IF (INXCTL) GO TO SCREEN
	IF (ENTRY.EQ.BLANKS) ENTRY = DFTRMS
	TERMS = ENTRY
	XCALL OUTPT (ROW,COL,0,TERMS,V)
	TBLFND(1,2) = '04'
	TBLFND(3,3) = ENTRY
	CALL CLRTBL
	SRCCTL = 2
	XCALL SERCH (3,RD153A,TBLFND,1,3,ORG153,BSMID,SRCCTL,1,6,11,0,0,0,0)
	IF (SRCCTL.EQ.0.AND.CNGCTL) GO TO ANYCN
	IF (SRCCTL.EQ.0) GO TO SEVEN
	XCALL MESAG ('CODE IS NOT ON FILE',1)
	GO TO SIX

SEVEN,
	CONTRL = '07,20,02,00,A '
	CALL INPUT
	IF (INXCTL) GO TO SCREEN
	IF (ENTRY.EQ.BLANKS) ENTRY = DFUSRC
	USERCD = ENTRY
	XCALL OUTPT (ROW,COL,0,USERCD,V)
	IF (CNGCTL) GO TO ANYCN

EIGHT,
	CONTRL = '08,20,01,00,YY '
	CALL INPUT
	PRTPRC = ENTRY
	IF (CNGCTL) GO TO ANYCN
NINE,
	IF (CNGCTL .EQ. 1)
		BEGIN
		CONTRL = '09,20,01,00,YY '
		CALL INPUT
		ACKNWL = ENTRY
		END
	IF (CNGCTL) GO TO ANYCN
TEN,
	IF (CNGCTL .EQ. 1)
		BEGIN
		CONTRL = '10,20,01,00,YY '
		CALL INPUT
		CONFRM = ENTRY
		END
	IF (CNGCTL) GO TO ANYCN
ELEVEN,
	IF (CNGCTL .EQ. 1)
		BEGIN
		CONTRL = '11,20,10,00,#  '
		CALL INPUT
		VFAX = ENTRY(1,10)
		ENTRY(1,12) = VFAX, 'XXX-XXX-XXXX'
		XCALL OUTPT(ROW,COL,0,ENTRY(1,12),V)
	;;;	ACTIVE = INXCTL
		END
	IF (CNGCTL) GO TO ANYCN
TWELVE,
	CONTRL = '03,76,01,00,A '
	CALL INPUT
	IF (INXCTL) GO TO SCREEN
	COLPPD = ENTRY
	IF(COLPPD.NE.'C' .AND. COLPPD.NE.'P')GOTO TWELVE
	IF (CNGCTL) GO TO ANYCN

;**********************************************************************
ANYCN,
	XCALL ANYCN (CNGCTL,WHATNO)
	IF (CNGCTL) GO TO (MSG2,MSG2,THREE,FOUR,FIVE,SIX,SEVEN,EIGHT,NINE,
&	TEN,ELEVEN,TWELVE),WHATNO
	IF(WHATNO.GT.20) GO TO ANYCN

;SSQ read the existing record, compare it to the "unchanged" record
;	saved befor updating, if different, some other pgm has updated
;	this vendor record between the initial read and this write...

;;;	XCALL IO (2,VENBF2,IRC011,READ,LOKCTL)	;SSQ 01-09-02
	XCALL ISIO (2,VENBF2,KVENNO,READ,LOKCTL)	
	if (venbf2 .ne. venbuf)
		begin
		xcall mesag ('Vendor updated by another user',1)
		goto screen
		end

	DUMMY = AVCNTR
	AVCNTR = DUMMY
	LOKCTL = NOABRT
	XCALL ISIO (2,RD011A,KVENNO,WRITE,LOKCTL)
;;;	XCALL IO (2,RD011A,IRC011,WRITE,LOKCTL)

;;;	LOKCTL = NOABRT
;;;	XCALL IO (2,RD011B,MAX011,READ,LOKCTL)
;;;	LOKCTL = NOABRT
;;;	XCALL IO (2,RD011B,1,READ,LOKCTL)

	UNLOCK 2
	GO TO SCREEN
;**********************************************************************
MSG1,
	XCALL MESAG ('RECORD NOT ON FILE',1)
	GO TO VENNUM
;**********************************************************************
MSG2,
	XCALL MESAG ('KEY FIELDS MAY NOT BE CHANGED',1)
	GO TO ANYCN
;**********************************************************************
MSG3,
	XCALL MESAG ('END OF FILE',2)
	GO TO ENDOFF
;**********************************************************************
MSG4,
	XCALL MESAG ('PURCHASING DATA IS ALREADY ADDED FOR THIS RECORD',2)
	GO TO SCREEN
;**********************************************************************
FNDTBL,
	BSMID = 1
	SRCCTL = 2
	XCALL SERCH (3,RD153A,PBLKEY,1,2,ORG153,BSMID,SRCCTL,
&                     5,6,11,0,0,0,0)
	IF (SRCCTL.EQ.0) GO TO TBLOOP
	XCALL OUTPT (4,24,0,'TABLE NUMBER',V)
	XCALL OUTPT (4,37,0,PBLKEY,V)
	XCALL OUTPT (5,24,0,'HAS NO ENTRIES.',V)
	RETURN

TBLOOP,
	ROW = 3
	SAVTNO = TTBLNO
LOOP,
	INCR ROW
	IF (ROW.GT.10) RETURN
	XCALL OUTPT (ROW,26,0,TCODE,V)
	XCALL OUTPT (ROW,28,0,'=',V)
	KDESC = TDESC(1,15)
	XCALL OUTPT (ROW,30,0,KDESC,V)
	INCR BSMID
	LOKCTL = NOABRT
	XCALL IO (3,RD153A,BSMID,READ,LOKCTL)
	IF (SAVTNO.NE.TTBLNO)  RETURN
	GO TO LOOP

;**********************************************************************
CLRTBL,
	ROW = 4
LOPCLR,
	IF (ROW.GT.12) RETURN
	XCALL OUTPT (ROW,24,0,'                          ',V)
	INCR ROW
	GO TO LOPCLR

;**********************************************************************
S_VIA,
	CLEAR COPTBL
	TBLCOD = 'P1'
	FIND (CHN182,COPTBL,TBL_KEY) [ERR=SV_START]
SV_START,
	ROW = 3
	SUB = 
SV_LOOP,
	XCALL IOS (CHN182,COPTBL,READ,LOKCTL)
	IF (TBLCOD .NE. 'P1') GOTO SV_EOF
	INCR SUB
	SVCODE(SUB) = P1_CODE
	SVSCAC(SUB) = P1_SCAC
	IF (SUB .LT. 10) GOTO SV_LOOP
SV_EOF,
	NUMSV = SUB
	FOR SUB FROM 1 THRU NUMSV
		BEGIN
		SVL_CODE = SVCODE(SUB)
		SVL_SCAC = SVSCAC(SUB)
		CLEAR TBL_KEY
		TBL_KEY(1,2) = 'SC'
		SC_SCAC = SVL_SCAC
		XCALL ISIO (CHN182,COPTBL,TBL_KEY,READ,LOKCTL)
		SVL_NAME = SC_NAME
		XCALL GETRFA(CHN182,SVRFA(SUB))
		INCR ROW
		XCALL OUTPT (ROW,26,0,SVLINE,V)
		END

	RETURN

	
;**********************************************************************
INPUT,
	XCALL INPUT (ROW,COL,MAX,MIN,TYPE,ENTRY,INXCTL,V)
	RETURN

;**********************************************************************
CLOSE,	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	IF (CHN011) XCALL FILES (CHN011,'SU',011,4)
;;;	IF (CHN012) XCALL FILES (CHN012,'I',012,4)
	IF (CHN153) XCALL FILES (CHN153,'I',153,4)
	IF (CHN182) CLOSE CHN182
	RETURN
;---------------------------------------------------

OPENS,	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
	CLEAR OPNOK

;;;	SWITCH = 5
;;;	XCALL FILES (1,'I',12,SWITCH)	;VENDOR INDEX
;;;	IF (SWITCH.EQ.9) RETURN
;;;	CHN012 = 1

	SWITCH = 5
	XCALL FILES (2,'SU',11,SWITCH)	;VENDOR MASTER
	IF (SWITCH.EQ.9) RETURN
	CHN011 = 2

	SWITCH = 1
	XCALL FILES (3,'I',153,SWITCH)	;PURCHASE ORDER TABLES FILE
	IF (SWITCH.EQ.9) RETURN
	CHN153 = 3

	SWITCH = 5
	XCALL FILES (4,'SI',182,SWITCH)	;COP TABLES FILE
	IF (SWITCH .EQ. 9) RETURN
	CHN182 = 4


	LOKCTL = NOABRT
;;;	XCALL IO (2,RD011B,1,READ,LOKCTL)	;READ THE CONTROL RECORD
;;;	LOKCTL = NOABRT
	XCALL IO (3,RD153B,1,READ,LOKCTL)	;READ THE TABLE CONTROL RECORD

	OPNOK = 1
	RETURN
;--------------------------------------------------
END

